<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<title>DuckFlix VR v4</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
<style>
body { margin:0; background:black; color:white; font-family:Arial; }

/* ===== TELA 2D ===== */
#start2d{
  position:fixed; inset:0; z-index:10;
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
  background:radial-gradient(#111,#000);
}
button{
  padding:14px 28px; margin:10px; font-size:18px;
  border-radius:10px; border:none;
  background:#0077ff; color:white;
}
button:disabled{ background:#333; }
</style>
</head>

<body>

<!-- ===== TELA 2D ===== -->
<div id="start2d">
  <h1>ğŸ¦† DuckFlix VR</h1>
  <p>Selecione sua pasta de filmes</p>
  <button id="pickFolder">ğŸ“‚ Escolher Pasta</button>
  <button id="enterVR" disabled>ğŸ•¶ï¸ Entrar no Cinema VR</button>
</div>

<video id="video" playsinline crossorigin="anonymous"></video>

<!-- ===== CENA VR ===== -->
<a-scene vr-mode-ui="enabled:true">

  <!-- CAMERA + OLHAR -->
  <a-entity position="0 1.6 0">
    <a-camera>
      <a-cursor fuse="true" fuse-timeout="1200"
        material="color:yellow; shader:flat"></a-cursor>
    </a-camera>
  </a-entity>

  <!-- LUZ -->
  <a-light type="ambient" intensity="0.5"></a-light>
  <a-light type="point" intensity="1" position="0 3 -3"></a-light>

  <!-- CINEMA (CHÃƒO / TETO / PAREDES) -->
  <a-plane rotation="-90 0 0" width="16" height="16" color="#222"></a-plane>
  <a-plane position="0 4 0" rotation="90 0 0" width="16" height="16" color="#111"></a-plane>
  <a-plane position="0 2 -8" width="16" height="4" color="#111"></a-plane>
  <a-plane position="-8 2 0" rotation="0 90 0" width="16" height="4" color="#111"></a-plane>
  <a-plane position="8 2 0" rotation="0 -90 0" width="16" height="4" color="#111"></a-plane>

  <!-- CADEIRAS (simples) -->
  <a-box position="-1 0.5 -3" width="1" height="1" depth="1" color="#111"></a-box>
  <a-box position="1 0.5 -3" width="1" height="1" depth="1" color="#111"></a-box>

  <!-- TELA -->
  <a-video id="screen" src="#video"
    position="0 2.2 -7.8" width="8" height="4.5"
    material="shader:flat"></a-video>

  <!-- CONTROLES -->
  <a-box id="playPause" position="-1 0.8 -5" width="0.8" height="0.4" depth="0.2" color="#00aa00"></a-box>
  <a-text value="â¯" position="-1 0.8 -4.8" align="center"></a-text>

  <a-box id="volUp" position="0 0.8 -5" width="0.8" height="0.4" depth="0.2" color="#555"></a-box>
  <a-text value="ğŸ”Š +" position="0 0.8 -4.8" align="center"></a-text>

  <a-box id="volDown" position="1 0.8 -5" width="0.8" height="0.4" depth="0.2" color="#555"></a-box>
  <a-text value="ğŸ”‰ -" position="1 0.8 -4.8" align="center"></a-text>

  <!-- LISTA LATERAL -->
  <a-entity id="lista" position="5.5 3 -5"></a-entity>

  <!-- SCROLL -->
  <a-box id="scrollUp" position="5.5 3.8 -5" width="0.6" height="0.3" depth="0.2" color="#444"></a-box>
  <a-text value="â–²" position="5.5 3.8 -4.8" align="center"></a-text>

  <a-box id="scrollDown" position="5.5 0.2 -5" width="0.6" height="0.3" depth="0.2" color="#444"></a-box>
  <a-text value="â–¼" position="5.5 0.2 -4.8" align="center"></a-text>

</a-scene>

<script>
let rootDir=null, offset=0;
const video=document.getElementById("video");
const lista=document.getElementById("lista");
const start2d=document.getElementById("start2d");
const pickBtn=document.getElementById("pickFolder");
const enterBtn=document.getElementById("enterVR");

pickBtn.onclick=async()=>{
  rootDir=await window.showDirectoryPicker();
  enterBtn.disabled=false;
};

enterBtn.onclick=async()=>{
  start2d.style.display="none";
  document.querySelector("a-scene").enterVR();
  carregarFilmes();
};

async function carregarFilmes(){
  lista.innerHTML=""; offset=0;
  for await (const d of rootDir.values()){
    if(d.kind==="directory" && d.name==="Filmes"){
      for await (const f of d.values()){
        if(f.kind==="file"){
          const url=URL.createObjectURL(await f.getFile());
          criarItem(f.name,()=>{ video.src=url; video.play(); });
        }
      }
    }
  }
}

function criarItem(nome,acao){
  const b=document.createElement("a-plane");
  b.setAttribute("width","3");
  b.setAttribute("height","0.4");
  b.setAttribute("color","#333");
  b.setAttribute("position",`0 ${-offset} 0`);
  b.addEventListener("click",acao);

  const t=document.createElement("a-text");
  t.setAttribute("value",nome);
  t.setAttribute("align","left");
  t.setAttribute("width","3");
  t.setAttribute("position","-1.45 0 0.01");

  b.appendChild(t); lista.appendChild(b);
  offset+=0.45;
}

/* CONTROLES */
document.getElementById("playPause").onclick=()=> video.paused?video.play():video.pause();
document.getElementById("volUp").onclick=()=> video.volume=Math.min(1, video.volume+0.1);
document.getElementById("volDown").onclick=()=> video.volume=Math.max(0, video.volume-0.1);

/* SCROLL */
document.getElementById("scrollUp").onclick=()=> lista.object3D.position.y+=0.5;
document.getElementById("scrollDown").onclick=()=> lista.object3D.position.y-=0.5;
</script>

</body>
</html>
