<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="utf-8">
<title>DuckFlix VR v4.1</title>
<script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

<style>
body{margin:0;background:black;color:white;font-family:Arial}
#tela2d{
  position:fixed; inset:0; z-index:10;
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
  background:radial-gradient(#111,#000);
}
button{
  padding:14px 26px; margin:10px;
  font-size:18px; border-radius:10px;
  border:none; background:#0066ff; color:white;
}
button:disabled{background:#333}
</style>
</head>

<body>

<!-- ===== TELA 2D ===== -->
<div id="tela2d">
  <h1>ðŸ¦† DuckFlix VR</h1>
  <p>Escolha sua pasta de filmes</p>
  <button id="pick">ðŸ“‚ Escolher Pasta</button>
  <button id="startVR" disabled>ðŸŽ¬ Entrar no Cinema</button>
</div>

<video id="video" playsinline crossorigin="anonymous"></video>

<!-- ===== CENA VR ===== -->
<a-scene>

  <!-- CAMERA + GAZE PROFISSIONAL -->
  <a-entity position="0 1.6 0">
    <a-camera>
      <a-cursor
        fuse="true"
        fuse-timeout="1200"
        geometry="primitive:ring; radiusInner:0.015; radiusOuter:0.03"
        material="color:yellow; shader:flat; opacity:0.9">
      </a-cursor>
    </a-camera>
  </a-entity>

  <!-- LUZ -->
  <a-light type="ambient" intensity="0.5"></a-light>
  <a-light type="point" position="0 3 -3" intensity="1"></a-light>

  <!-- CINEMA -->
  <a-plane rotation="-90 0 0" width="20" height="20" color="#222"></a-plane>
  <a-plane position="0 4 0" rotation="90 0 0" width="20" height="20" color="#111"></a-plane>
  <a-plane position="0 2 -10" width="20" height="4" color="#111"></a-plane>

  <!-- TELA -->
  <a-video id="screen"
    src="#video"
    position="0 2.3 -9.8"
    width="9"
    height="5"
    material="shader:flat">
  </a-video>

  <!-- LISTA -->
  <a-entity id="lista" position="6 3 -6"></a-entity>

  <!-- SCROLL -->
  <a-box id="up" position="6 3.8 -6" width="0.6" height="0.3" depth="0.2" color="#555"></a-box>
  <a-text value="â–²" position="6 3.8 -5.8" align="center"></a-text>

  <a-box id="down" position="6 0.2 -6" width="0.6" height="0.3" depth="0.2" color="#555"></a-box>
  <a-text value="â–¼" position="6 0.2 -5.8" align="center"></a-text>

</a-scene>

<script>
let root=null, offset=0;
const video=document.getElementById("video");
const lista=document.getElementById("lista");

document.getElementById("pick").onclick=async()=>{
  root=await window.showDirectoryPicker();
  document.getElementById("startVR").disabled=false;
};

document.getElementById("startVR").onclick=()=>{
  document.getElementById("tela2d").style.display="none";
  document.querySelector("a-scene").enterVR();
  carregar();
};

async function carregar(){
  lista.innerHTML="";
  offset=0;
  for await (const d of root.values()){
    if(d.kind==="directory" && d.name==="Filmes"){
      for await (const f of d.values()){
        if(f.kind==="file" && f.name.match(/\.(mp4|webm)$/)){
          const url=URL.createObjectURL(await f.getFile());
          criarItem(f.name, url);
        }
      }
    }
  }
}

function criarItem(nome, url){
  const b=document.createElement("a-plane");
  b.setAttribute("width","3");
  b.setAttribute("height","0.4");
  b.setAttribute("color","#333");
  b.setAttribute("position",`0 ${-offset} 0`);

  let timer=null;

  b.addEventListener("mouseenter",()=>{
    b.setAttribute("color","#666");
    timer=setTimeout(()=>{
      video.src=url;
      video.play();
    },1200);
  });

  b.addEventListener("mouseleave",()=>{
    b.setAttribute("color","#333");
    clearTimeout(timer);
  });

  const t=document.createElement("a-text");
  t.setAttribute("value",nome);
  t.setAttribute("align","left");
  t.setAttribute("width","3");
  t.setAttribute("position","-1.45 0 0.01");

  b.appendChild(t);
  lista.appendChild(b);
  offset+=0.45;
}

/* SCROLL */
document.getElementById("up").addEventListener("mouseenter",()=>{
  lista.object3D.position.y+=0.5;
});
document.getElementById("down").addEventListener("mouseenter",()=>{
  lista.object3D.position.y-=0.5;
});
</script>

</body>
</html>
